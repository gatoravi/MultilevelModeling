---
title: "HW9"
author: "Avinash Ramu"
date: "November 13, 2016"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Q1.1
Determine how much missing data there is and if there is a discernable pattern. Now use mice to run a new model.
Also run a model omitting cases with missing data. What differences do you observe? Which is better?

```{r q1_1}
star98.missing <- read.table("star98.missing.dat",header=TRUE)
par(mfrow=c(1,2),mar=c(3,3,3,3))
plot(star98.missing$SUBSIDIZED.LUNCH,star98.missing$READING.ABOVE.50,pch="+",col="blue")
abline(lm(star98.missing$READING.ABOVE.50~star98.missing$SUBSIDIZED.LUNCH),lwd=3)
mtext(side=1,cex=1.3,line=2.5,"District Percent Receiving Subsidized Lunch")
mtext(side=2,cex=1.3,line=2.5,"District Percent Above National Reading Median")
plot(star98.missing$PTRATIO,star98.missing$READING.ABOVE.50,pch="+",col="blue")
abline(lm(star98.missing$READING.ABOVE.50~star98.missing$PTRATIO),lwd=3)
mtext(side=1,cex=1.3,line=2.5,"District Pupil/Teacher Ratio")
mtext(side=2,cex=1.3,line=2.5,"District Percent Above National Reading Median")
mtext(side=3,cex=1.5,outer=TRUE,line=-1,"Calfornia 9th Grade by District, 1998")


#Determine how much missing data there is:
sum(is.na(star98.missing))/prod(dim(star98.missing))
summary(star98.missing)
hist(apply(apply(star98.missing, 2, is.na), 1, sum))


lm1 <- lm(star98.missing$READING.ABOVE.50~star98.missing$SUBSIDIZED.LUNCH, na.action=na.omit)
lm2 <- lm(star98.missing$READING.ABOVE.50~star98.missing$PTRATIO, na.action=na.omit)
summary(lm1)
summary(lm2)

library(mice)
md.pattern(star98.missing)
m <- 50
star98.imp <- mice(star98.missing, m)
star98.mids1 <- lm.mids(star98.missing$READING.ABOVE.50~star98.missing$SUBSIDIZED.LUNCH,
	                      data=star98.imp)
star98.mids2 <- lm.mids(star98.missing$READING.ABOVE.50~star98.missing$PTRATIO,
	                      data=star98.imp)
summary(pool(star98.mids1))
summary(pool(star98.mids2))

```
A third of the cells have missing data. Only eight rows have all three columns not missing.
The missing data appears to be pretty random across the columns with no immediately apparent
pattern of missingness.


## Q2
Explain what the following R does and why you would not want to do this.
```{r q2_1}
mi <- function(data.mat) {
  for (i in 1:ncol(data.mat)) {
    if (sum(is.na(data.mat[,i])) > 0) {
      print(paste("column",i,"has missing data"))
      mean.col <- mean(data.mat[,i],na.rm=TRUE)
      for (j in 1:nrow(data.mat)) {
        if (is.na(data.mat[j,i]) ==TRUE) data.mat[j,i] <- mean.col
      }
    }
  }
  return(data.mat)
}
```

The code sets the missing values in a column to the mean value of the column. This underestimates the variance for that column. It also distorts relationships between variables by pulling the estimation of the correlation between them to zero.

## Q3
Find an article in your literature that uses case-wise deletion. Discuss how you might replicate the model and improve the work.